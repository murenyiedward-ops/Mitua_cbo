<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mitua Massive Family | Empowering Communities</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Playfair+Display:wght@700&display=swap');
        
        :root {
            --primary: #1e40af; /* Deep Blue */
            --accent: #10b981;  /* Emerald */
            --dark: #0f172a;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background: #ffffff; 
            color: #1e293b;
        }

        h1, h2, h3 { font-family: 'Inter', sans-serif; font-weight: 800; letter-spacing: -0.025em; }
        
        .hero-gradient {
            background: linear-gradient(rgba(15, 23, 42, 0.8), rgba(15, 23, 42, 0.8)), 
                        url('https://images.unsplash.com/photo-1531206715517-5c0ba140b2b8?auto=format&fit=crop&q=80');
            background-size: cover;
            background-position: center;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: slideUp 0.5s ease-out; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .nav-link { 
            font-weight: 600; 
            font-size: 14px; 
            color: #475569; 
            padding: 1rem 0;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        .nav-link.active { color: var(--primary); border-bottom-color: var(--primary); }

        .btn-primary {
            background: var(--primary);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 700;
            transition: all 0.3s;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.05em;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(30, 64, 175, 0.3); }

        .stat-card {
            border-top: 4px solid var(--primary);
        }

        .portal-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            transition: 0.2s;
        }
        .portal-nav-btn.active {
            background: white;
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body>

    <!-- TOP BAR -->
    <div class="bg-slate-900 text-white text-[10px] py-2 px-6 flex justify-between items-center font-bold uppercase tracking-widest">
        <div class="flex gap-4">
            <span><i class="fas fa-phone mr-2 text-emerald-400"></i>Chair: 0710234326</span>
            <span class="hidden md:inline"><i class="fas fa-map-marker-alt mr-2 text-emerald-400"></i>Bungoma, Kenya</span>
        </div>
        <div class="flex gap-4">
            <a href="#" class="hover:text-emerald-400"><i class="fab fa-facebook"></i></a>
            <a href="#" class="hover:text-emerald-400"><i class="fab fa-twitter"></i></a>
        </div>
    </div>

    <!-- MAIN NAV -->
    <header class="bg-white border-b sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 h-20 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <img src="https://i.postimg.cc/W4dNF0N4/Mitua_Logo.jpg" class="h-12 w-12 rounded-lg shadow-md">
                <div>
                    <h1 class="text-lg font-black text-slate-900 leading-none">MITUA MASSIVE</h1>
                    <p class="text-[9px] font-bold text-blue-600 uppercase tracking-widest">Community Organization</p>
                </div>
            </div>
            
            <nav class="hidden lg:flex gap-8">
                <button onclick="showTab('home')" class="nav-link active" id="btn-home">Home</button>
                <button onclick="showTab('news')" class="nav-link" id="btn-news">News</button>
                <button onclick="showTab('projects')" class="nav-link" id="btn-projects">Projects</button>
                <button onclick="handlePortalAccess()" class="nav-link" id="btn-portal">Portal</button>
            </nav>

            <button onclick="triggerLogin()" class="btn-primary">Login</button>
        </div>
    </header>

    <main>
        <!-- SECTION: HOME (SCORE CBO STYLE) -->
        <section id="home" class="tab-content active">
            <!-- HERO -->
            <div class="hero-gradient h-[500px] flex items-center px-6 text-white">
                <div class="max-w-4xl mx-auto text-center md:text-left">
                    <span class="bg-emerald-500 text-white text-[10px] font-black px-4 py-2 rounded-full uppercase mb-6 inline-block tracking-widest">Est. 2024</span>
                    <h2 class="text-4xl md:text-6xl font-black mb-6 leading-tight uppercase">Building Stronger <br><span class="text-emerald-400">Communities</span> Together</h2>
                    <p class="text-lg text-slate-300 mb-8 max-w-xl font-medium">Mitua Massive Family is a Community Based Organization dedicated to empowering families in Naitiri Kabuyefwe and Tongaren through sustainable projects.</p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start">
                        <button onclick="showTab('projects')" class="btn-primary bg-emerald-500 border-none">Our Initiatives</button>
                        <button onclick="window.location.href='tel:0710234326'" class="bg-white text-slate-900 px-6 py-3 rounded-xl font-bold text-xs uppercase hover:bg-slate-100 transition">Contact Chairperson</button>
                    </div>
                </div>
            </div>

            <!-- ABOUT SUMMARY -->
            <div class="max-w-7xl mx-auto px-6 py-20 grid md:grid-cols-3 gap-12">
                <div class="stat-card bg-slate-50 p-10 rounded-2xl">
                    <div class="w-14 h-14 bg-blue-100 text-blue-600 rounded-xl flex items-center justify-center text-2xl mb-6">
                        <i class="fas fa-bullseye"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-4 uppercase">Our Mission</h3>
                    <p class="text-slate-600 text-sm leading-relaxed">To provide a platform for community members to pool resources and expertise for socio-economic empowerment and welfare support.</p>
                </div>
                <div class="stat-card bg-slate-50 p-10 rounded-2xl border-emerald-500" style="border-top-color: #10b981;">
                    <div class="w-14 h-14 bg-emerald-100 text-emerald-600 rounded-xl flex items-center justify-center text-2xl mb-6">
                        <i class="fas fa-eye"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-4 uppercase">Our Vision</h3>
                    <p class="text-slate-600 text-sm leading-relaxed">A self-sustaining community where every family has access to quality education, healthcare, and economic opportunity.</p>
                </div>
                <div class="stat-card bg-slate-50 p-10 rounded-2xl border-orange-500" style="border-top-color: #f97316;">
                    <div class="w-14 h-14 bg-orange-100 text-orange-600 rounded-xl flex items-center justify-center text-2xl mb-6">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-4 uppercase">Our Values</h3>
                    <p class="text-slate-600 text-sm leading-relaxed">Transparency, Accountability, Integrity, and Solidarity in every project we undertake in Naitiri and beyond.</p>
                </div>
            </div>

            <!-- CALL TO DONORS SECTION -->
            <div class="bg-slate-900 py-20 px-6 text-center text-white">
                <h2 class="text-3xl font-black mb-4 uppercase tracking-tight">Become a Partner</h2>
                <p class="text-slate-400 max-w-2xl mx-auto mb-10">We welcome donors, well-wishers, and volunteers to join us in our upcoming December Outreach. Your contribution changes lives.</p>
                <div class="bg-white/5 border border-white/10 rounded-3xl p-8 max-w-md mx-auto">
                    <p class="text-emerald-400 font-black text-3xl mb-1">Paybill: 247247</p>
                    <p class="text-slate-400 text-xs font-bold uppercase mb-6 tracking-widest">Acc: [CBO Number]</p>
                    <p class="text-slate-300 text-sm italic mb-6">"Helping one person might not change the world, but it could change the world for that one person."</p>
                    <a href="tel:0710234326" class="btn-primary inline-block w-full">Call Chairperson to Donate</a>
                </div>
            </div>
        </section>

        <!-- SECTION: NEWS -->
        <section id="news" class="tab-content">
            <div class="max-w-4xl mx-auto px-6 py-12">
                <h2 class="text-3xl font-black uppercase mb-10 border-l-8 border-blue-600 pl-6">Updates</h2>
                <div class="space-y-6" id="newsFeed">
                    <div class="bg-white border rounded-2xl p-8 shadow-sm">
                        <span class="text-xs font-bold text-blue-600 uppercase mb-2 block">System Announcement</span>
                        <h3 class="text-xl font-black mb-4">MEMBER PORTAL UPDATED</h3>
                        <p class="text-slate-600 text-sm mb-4">The executive committee is pleased to announce the full integration of our digital membership and financial tracking system.</p>
                        <button class="text-blue-600 font-bold text-xs uppercase tracking-widest">Read More <i class="fas fa-arrow-right ml-2"></i></button>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: PROJECTS -->
        <section id="projects" class="tab-content">
            <div class="max-w-7xl mx-auto px-6 py-12">
                <h2 class="text-3xl font-black uppercase mb-10 border-l-8 border-emerald-500 pl-6 text-slate-900">Active Roadmap</h2>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="group cursor-pointer">
                        <div class="h-64 bg-slate-200 rounded-3xl mb-6 overflow-hidden relative">
                             <div class="absolute inset-0 bg-gradient-to-t from-slate-900 to-transparent flex items-end p-8">
                                <span class="bg-emerald-500 text-white text-[10px] font-bold px-3 py-1 rounded-full uppercase absolute top-6 right-6">Active</span>
                                <h3 class="text-white text-2xl font-black uppercase">Poultry Farming</h3>
                             </div>
                        </div>
                        <p class="text-slate-500 text-sm leading-relaxed">Sustainable agricultural practices for local families in Kabuyefwe to ensure food security and income.</p>
                    </div>
                    <div class="group cursor-pointer">
                        <div class="h-64 bg-slate-200 rounded-3xl mb-6 overflow-hidden relative">
                             <div class="absolute inset-0 bg-gradient-to-t from-blue-900 to-transparent flex items-end p-8">
                                <span class="bg-blue-500 text-white text-[10px] font-bold px-3 py-1 rounded-full uppercase absolute top-6 right-6">Planning</span>
                                <h3 class="text-white text-2xl font-black uppercase">Dec Mission 2024</h3>
                             </div>
                        </div>
                        <p class="text-slate-500 text-sm leading-relaxed">Our annual flagship outreach targeting vulnerable children and the elderly with supplies and care.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: PORTAL -->
        <section id="portal" class="tab-content px-6 py-12 max-w-7xl mx-auto">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-10">
                <button onclick="showSubTab('p-members')" id="s-members" class="portal-nav-btn active">
                    <i class="fas fa-users-line text-xl mb-2"></i>
                    <span class="text-[10px] font-bold uppercase tracking-widest">Members</span>
                </button>
                <button onclick="showSubTab('p-finance')" id="s-finance" class="portal-nav-btn">
                    <i class="fas fa-file-invoice-dollar text-xl mb-2"></i>
                    <span class="text-[10px] font-bold uppercase tracking-widest">Finances</span>
                </button>
                <button onclick="showSubTab('p-admin')" id="s-admin" class="portal-nav-btn hidden">
                    <i class="fas fa-tools text-xl mb-2"></i>
                    <span class="text-[10px] font-bold uppercase tracking-widest">Manage</span>
                </button>
                <button onclick="showTab('home')" class="portal-nav-btn">
                    <i class="fas fa-power-off text-xl mb-2"></i>
                    <span class="text-[10px] font-bold uppercase tracking-widest">Exit</span>
                </button>
            </div>

            <div id="p-members" class="p-sub-tab active bg-white border rounded-3xl p-8 shadow-sm">
                <h3 class="text-lg font-black uppercase mb-6 tracking-tight text-slate-800">CBO Member Directory</h3>
                <div id="listDisplay" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>

            <div id="p-finance" class="p-sub-tab hidden bg-slate-900 text-white rounded-3xl p-8 shadow-xl">
                <div class="flex justify-between items-center mb-10 border-b border-white/10 pb-6">
                    <div>
                        <p class="text-[10px] font-black uppercase text-emerald-400 tracking-widest mb-1">Total Contributions</p>
                        <h2 id="totalFinance" class="text-4xl font-black tracking-tighter">0/=</h2>
                    </div>
                    <i class="fas fa-vault text-5xl text-white/10"></i>
                </div>
                <div id="financeDisplay" class="space-y-4"></div>
            </div>

            <div id="p-admin" class="p-sub-tab hidden space-y-6">
                <!-- Management Panel -->
                <div class="bg-white border-4 border-blue-600 rounded-3xl p-8 shadow-2xl">
                    <div class="flex items-center gap-4 mb-8">
                        <div class="w-12 h-12 bg-blue-600 text-white rounded-xl flex items-center justify-center text-xl">
                            <i class="fas fa-user-edit"></i>
                        </div>
                        <h3 class="text-2xl font-black uppercase tracking-tight text-slate-900">Member Management</h3>
                    </div>

                    <div class="grid md:grid-cols-2 gap-10">
                        <!-- Add Member -->
                        <div class="space-y-4">
                            <h4 class="font-bold text-xs uppercase tracking-widest text-slate-400">Register New Member</h4>
                            <input id="newName" type="text" placeholder="Member Full Name" class="w-full bg-slate-50 border p-4 rounded-xl font-semibold text-sm">
                            <input id="newAmt" type="number" placeholder="Opening Contribution" class="w-full bg-slate-50 border p-4 rounded-xl font-semibold text-sm">
                            <button onclick="addNewMember()" class="w-full btn-primary bg-emerald-600 border-none">Create Profile</button>
                        </div>
                        <!-- Edit Member -->
                        <div class="space-y-4">
                            <h4 class="font-bold text-xs uppercase tracking-widest text-slate-400">Modify / Update Records</h4>
                            <select id="admSelect" onchange="loadMemberToEdit()" class="w-full bg-slate-50 border p-4 rounded-xl font-semibold text-sm"></select>
                            <div id="editFields" class="hidden space-y-4 pt-4">
                                <input id="editName" type="text" class="w-full border p-4 rounded-xl font-semibold text-sm" placeholder="Update Name">
                                <input id="editAmt" type="number" class="w-full border p-4 rounded-xl font-semibold text-sm" placeholder="Update Balance">
                                <div class="grid grid-cols-2 gap-4">
                                    <button onclick="saveAdminData()" class="btn-primary">Save</button>
                                    <button onclick="removeMember()" class="bg-red-50 text-red-600 border border-red-100 font-bold py-3 rounded-xl uppercase text-[10px]">Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-slate-900 text-white py-12 px-6 border-t border-white/5">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-8">
            <div class="text-center md:text-left">
                <h4 class="font-black uppercase text-lg mb-2">Mitua Massive Family</h4>
                <p class="text-slate-400 text-sm">Naitiri Kabuyefwe & Tongaren Community CBO</p>
            </div>
            <div class="text-center md:text-right">
                <p class="text-slate-400 text-[10px] uppercase font-bold mb-2 tracking-widest">Official Contact</p>
                <p class="text-xl font-black text-emerald-400">Chair: 0710234326</p>
            </div>
        </div>
        <div class="text-center mt-12 pt-12 border-t border-white/5 text-slate-500 text-[10px] font-bold uppercase tracking-widest">
            &copy; 2026 Mitua Massive Family Organization. All Rights Reserved.
        </div>
    </footer>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyDOwV2LyxvZlUSpqiqBFsTAO5CVTSBI940", 
            authDomain: "mitua-cbo.firebaseapp.com", 
            projectId: "mitua-cbo", 
            storageBucket: "mitua-cbo.appspot.com", 
            messagingSenderId: "1027796270356", 
            appId: "1:1027796270356:web:d7bb6dd472bc8038129601" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let userRole = 'public';
        let membersData = [];

        function init() {
            db.collection('members').orderBy('n').onSnapshot(snap => {
                membersData = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                renderMembers();
            });
        }

        function renderMembers() {
            const listEl = document.getElementById('listDisplay');
            const finEl = document.getElementById('financeDisplay');
            const admSel = document.getElementById('admSelect');
            let total = 0;

            listEl.innerHTML = '';
            finEl.innerHTML = '';
            admSel.innerHTML = '<option value="">-- Select Member to Manage --</option>';

            membersData.forEach(m => {
                const amt = Number(m.amt) || 0;
                total += amt;

                listEl.innerHTML += `
                    <div class="bg-slate-50 p-6 rounded-2xl flex items-center gap-4 border border-slate-100">
                        <div class="w-12 h-12 bg-white rounded-xl shadow-sm flex items-center justify-center font-black text-blue-600 uppercase text-lg">${m.n.charAt(0)}</div>
                        <div>
                            <p class="font-black text-slate-900 leading-none mb-1">${m.n}</p>
                            <p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest">Active Member</p>
                        </div>
                    </div>
                `;

                finEl.innerHTML += `
                    <div class="flex justify-between items-center py-4 border-b border-white/5">
                        <span class="font-bold text-slate-300 text-sm uppercase tracking-wide">${m.n}</span>
                        <span class="font-black text-emerald-400 font-mono">${amt.toLocaleString()}/=</span>
                    </div>
                `;

                admSel.innerHTML += `<option value="${m.id}">${m.n}</option>`;
            });

            document.getElementById('totalFinance').innerText = `${total.toLocaleString()}/=`;
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            if(document.getElementById('btn-' + tabId)) document.getElementById('btn-' + tabId).classList.add('active');
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function showSubTab(subId) {
            document.querySelectorAll('.p-sub-tab').forEach(c => c.classList.add('hidden'));
            document.querySelectorAll('.portal-nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(subId).classList.remove('hidden');
            const btnId = subId.replace('p-', 's-');
            document.getElementById(btnId).classList.add('active');
        }

        function triggerLogin() {
            Swal.fire({
                title: 'RESTRICTED ACCESS',
                text: 'Authentication required for Portal services.',
                showDenyButton: true,
                confirmButtonText: 'Leader Access',
                denyButtonText: 'Member View',
                confirmButtonColor: '#1e40af',
                denyButtonColor: '#0f172a'
            }).then(r => {
                if(r.isConfirmed) promptPIN('leader', '1234');
                else if(r.isDenied) promptPIN('member', '9999');
            });
        }

        function promptPIN(role, pin) {
            Swal.fire({ title: 'System Security PIN', input: 'password' }).then(r => {
                if(r.value === pin) {
                    userRole = role;
                    if(role === 'leader') document.getElementById('s-admin').classList.remove('hidden');
                    else document.getElementById('s-admin').classList.add('hidden');
                    showTab('portal');
                    showSubTab('p-members');
                } else {
                    Swal.fire('Access Denied', 'Invalid authentication credentials.', 'error');
                }
            });
        }

        function handlePortalAccess() {
            if(userRole === 'public') triggerLogin();
            else showTab('portal');
        }

        function loadMemberToEdit() {
            const id = document.getElementById('admSelect').value;
            if(!id) { document.getElementById('editFields').classList.add('hidden'); return; }
            const m = membersData.find(mem => mem.id === id);
            document.getElementById('editName').value = m.n;
            document.getElementById('editAmt').value = m.amt || 0;
            document.getElementById('editFields').classList.remove('hidden');
        }

        async function addNewMember() {
            const n = document.getElementById('newName').value.trim();
            const a = Number(document.getElementById('newAmt').value);
            if(!n) return;
            await db.collection('members').add({ n, amt: a });
            Swal.fire('Created', `${n} added to registry`, 'success');
            document.getElementById('newName').value = '';
            document.getElementById('newAmt').value = '';
        }

        async function saveAdminData() {
            const id = document.getElementById('admSelect').value;
            const n = document.getElementById('editName').value.trim();
            const a = Number(document.getElementById('editAmt').value);
            await db.collection('members').doc(id).update({ n, amt: a });
            Swal.fire('Updated', 'Record saved successfully', 'success');
        }

        async function removeMember() {
            const id = document.getElementById('admSelect').value;
            const result = await Swal.fire({ title: 'Confirm Deletion', text: "Cannot be undone.", icon: 'warning', showCancelButton: true });
            if(result.isConfirmed) {
                await db.collection('members').doc(id).delete();
                document.getElementById('editFields').classList.add('hidden');
            }
        }

        init();
    </script>
</body>
</html>

