<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mitua Massive Family | Naitiri Kabuyefwe & Tongaren CBO</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&family=Open+Sans:wght@400;600&display=swap');
        
        :root {
            --score-green: #2ecc71;
            --score-dark: #2c3e50;
            --score-light: #ecf0f1;
            --mission-gold: #f1c40f;
        }

        body { 
            font-family: 'Open Sans', sans-serif; 
            background: #f8fafc; 
            color: #333;
        }

        h1, h2, h3, h4 { font-family: 'Montserrat', sans-serif; }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .nav-link { font-weight: 700; font-size: 11px; transition: 0.3s; cursor: pointer; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 2px solid transparent; }
        .nav-link.active { color: var(--score-green); border-bottom: 2px solid var(--score-green); }

        .portal-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border-radius: 12px;
            transition: 0.2s;
            background: white;
            border: 1px solid #e2e8f0;
            min-height: 70px;
        }
        .portal-nav-btn.active {
            background: #f0fdf4;
            border-color: #22c55e;
            color: #15803d;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        .audit-log {
            background: #0f172a;
            color: #4ade80;
            font-family: monospace;
            font-size: 10px;
            padding: 12px;
            border-radius: 12px;
            height: 120px;
            overflow-y: auto;
        }

        .donation-gradient {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }
    </style>
</head>
<body>

    <!-- TOP IDENTITY BAR -->
    <div class="bg-white border-b px-6 py-3 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <img src="https://i.postimg.cc/W4dNF0N4/Mitua_Logo.jpg" class="h-10 w-10 rounded-lg shadow-sm">
            <div>
                <h1 class="text-sm font-black text-slate-800 uppercase tracking-tighter leading-none">Mitua Massive Family</h1>
                <p class="text-[8px] font-bold text-emerald-600 uppercase mt-1">Unified CBO Portal</p>
            </div>
        </div>
        <button onclick="triggerLogin()" class="bg-slate-800 text-white text-[9px] font-black px-4 py-2 rounded-lg uppercase tracking-widest shadow-lg active:scale-95 transition">Login</button>
    </div>

    <!-- MAIN APP NAVIGATION -->
    <nav class="bg-white border-b px-4 overflow-x-auto whitespace-nowrap sticky top-[64px] z-40">
        <div class="max-w-7xl mx-auto flex gap-6">
            <button onclick="showTab('home')" class="nav-link py-4 active" id="btn-home">Home</button>
            <button onclick="showTab('news')" class="nav-link py-4" id="btn-news">News</button>
            <button onclick="showTab('projects')" class="nav-link py-4" id="btn-projects">Projects</button>
            <button onclick="handlePortalAccess()" class="nav-link py-4" id="btn-portal">Member Portal</button>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-4 md:p-6 pb-24">
        
        <!-- SECTION: HOME -->
        <section id="home" class="tab-content active">
            <!-- HERO WELCOME -->
            <div class="bg-slate-900 rounded-3xl p-8 text-white mb-6 relative overflow-hidden">
                <div class="relative z-10">
                    <span class="bg-yellow-500 text-slate-900 text-[10px] font-black px-3 py-1 rounded-full uppercase">Community Call</span>
                    <h2 class="text-3xl font-black mt-4 mb-2 uppercase leading-none">A Warm Welcome<br>To Our Donors</h2>
                    <p class="text-xs text-slate-400 max-w-xs mb-6">We invite partners and well-wishers to support our December 2024 Outreach mission in Naitiri Kabuyefwe and Tongaren.</p>
                    <div class="flex gap-3">
                        <button onclick="showTab('projects')" class="bg-emerald-500 text-white px-5 py-3 rounded-xl font-bold text-[10px] uppercase shadow-lg">Our Roadmap</button>
                        <button onclick="scrollToSupport()" class="bg-white/10 border border-white/20 text-white px-5 py-3 rounded-xl font-bold text-[10px] uppercase">Partner With Us</button>
                    </div>
                </div>
                <div class="absolute right-[-20px] bottom-[-20px] opacity-10"><i class="fas fa-handshake text-[150px]"></i></div>
            </div>

            <!-- STATS GRID -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                <div class="bg-white p-5 rounded-2xl border shadow-sm">
                    <p class="text-slate-400 text-[9px] font-bold uppercase mb-1">Total Members</p>
                    <p id="statMembers" class="text-2xl font-black text-slate-800">--</p>
                </div>
                <div class="bg-white p-5 rounded-2xl border shadow-sm">
                    <p class="text-slate-400 text-[9px] font-bold uppercase mb-1">CBO Status</p>
                    <p class="text-xl font-black text-emerald-600">ACTIVE</p>
                </div>
                <div class="bg-white p-5 rounded-2xl border shadow-sm">
                    <p class="text-slate-400 text-[9px] font-bold uppercase mb-1">Mission Target</p>
                    <p class="text-xl font-black text-blue-600">500+ Lives</p>
                </div>
                <div class="bg-white p-5 rounded-2xl border shadow-sm">
                    <p class="text-slate-400 text-[9px] font-bold uppercase mb-1">Headquarters</p>
                    <p class="text-sm font-black text-slate-800 uppercase">Kabuyefwe</p>
                </div>
            </div>

            <!-- NEW SECTION: DONOR & VOLUNTEER CALL -->
            <div id="support-section" class="donation-gradient rounded-3xl p-6 text-white mb-6">
                <div class="flex flex-col md:flex-row gap-6 items-center">
                    <div class="md:w-2/3">
                        <h3 class="font-black text-lg uppercase tracking-tight mb-2 text-emerald-400">Join the Mission</h3>
                        <p class="text-xs text-slate-300 leading-relaxed mb-4">
                            Your support provides school kits, food hampers, and sanitary supplies to vulnerable families. Whether you give financially or donate your time as a volunteer, you are making a massive impact.
                        </p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                            <div class="bg-white/5 border border-white/10 p-4 rounded-2xl">
                                <i class="fas fa-heart text-red-400 mb-2"></i>
                                <h4 class="font-bold text-xs uppercase">Donate Funds</h4>
                                <p class="text-[10px] text-slate-400 mt-1">Support via M-Pesa or Bank transfer. Every shilling counts.</p>
                            </div>
                            <div class="bg-white/5 border border-white/10 p-4 rounded-2xl">
                                <i class="fas fa-hands-helping text-blue-400 mb-2"></i>
                                <h4 class="font-bold text-xs uppercase">Volunteer</h4>
                                <p class="text-[10px] text-slate-400 mt-1">Join our ground team for distribution and community service.</p>
                            </div>
                        </div>
                    </div>
                    <div class="md:w-1/3 w-full bg-white rounded-2xl p-5 text-slate-800 text-center">
                        <p class="text-[10px] font-black uppercase text-slate-400 mb-2 tracking-widest">Official Paybill</p>
                        <p class="text-2xl font-black text-emerald-600 mb-1 leading-none">247247</p>
                        <p class="text-[10px] font-bold text-slate-400 mb-4">A/C: [Insert Number]</p>
                        <button onclick="Swal.fire('Thank You!', 'Please contact our PR Manager for official receipting and partnership documentation.', 'info')" class="w-full bg-slate-900 text-white py-3 rounded-xl text-[10px] font-black uppercase tracking-widest active:scale-95 transition">Inquire More</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: NEWS -->
        <section id="news" class="tab-content">
            <h2 class="text-lg font-black uppercase text-slate-800 mb-6">Announcements</h2>
            <div class="space-y-4" id="newsFeed">
                <div class="bg-white p-5 rounded-2xl border shadow-sm border-l-4 border-emerald-500">
                    <span class="text-[9px] font-bold text-emerald-500 uppercase">Special Update</span>
                    <h3 class="font-bold text-slate-800 mt-1 uppercase">Partnership Invitation</h3>
                    <p class="text-xs text-slate-500 mt-2 leading-relaxed">We are officially opening our doors to international and local donors for the December mission. All contributions are audited and recorded transparently.</p>
                </div>
                <div class="bg-white p-5 rounded-2xl border shadow-sm">
                    <span class="text-[9px] font-bold text-slate-400 uppercase">System Update</span>
                    <h3 class="font-bold text-slate-800 mt-1 uppercase tracking-tight">Management Tools Online</h3>
                    <p class="text-xs text-slate-500 mt-2 leading-relaxed">Leaders can now add, edit, and remove members directly from the portal dashboard.</p>
                </div>
            </div>
        </section>

        <!-- SECTION: PROJECTS -->
        <section id="projects" class="tab-content">
            <h2 class="text-lg font-black uppercase text-slate-800 mb-6">Our Roadmap</h2>
            <div class="grid gap-4">
                <div class="bg-slate-900 text-white p-6 rounded-3xl border shadow-lg relative overflow-hidden">
                    <div class="relative z-10">
                        <div class="flex justify-between items-start mb-4">
                            <span class="bg-emerald-500/20 text-emerald-400 border border-emerald-500/30 text-[9px] font-black px-3 py-1 rounded-full uppercase tracking-widest">Main Mission</span>
                            <span class="text-[10px] font-bold text-slate-400">Dec 2024</span>
                        </div>
                        <h3 class="font-black text-xl uppercase leading-none mb-2">Outreach & Empowerment</h3>
                        <p class="text-xs text-slate-400 mb-4">Providing essential kits to 100+ students and food support for 50 elderly residents.</p>
                        <div class="w-full bg-white/10 rounded-full h-2 mb-2">
                            <div class="bg-emerald-500 h-2 rounded-full w-1/3"></div>
                        </div>
                        <p class="text-[9px] font-bold text-slate-400 uppercase">Current Funding: 32%</p>
                    </div>
                    <i class="fas fa-bullseye absolute right-[-10px] top-10 text-white/5 text-[100px]"></i>
                </div>

                <div class="bg-white p-6 rounded-3xl border flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-emerald-100 rounded-2xl flex items-center justify-center text-emerald-600">
                            <i class="fas fa-egg"></i>
                        </div>
                        <div>
                            <h3 class="font-black text-sm uppercase">Poultry Unit</h3>
                            <p class="text-[10px] text-slate-400">Kabuyefwe Ward</p>
                        </div>
                    </div>
                    <span class="text-[10px] font-black bg-emerald-50 text-emerald-700 px-3 py-1 rounded-full uppercase">Operational</span>
                </div>
            </div>
        </section>

        <!-- SECTION: MEMBER PORTAL (SECURE) -->
        <section id="portal" class="tab-content">
            <!-- PORTAL NAVIGATION -->
            <div class="grid grid-cols-4 gap-2 mb-6">
                <button onclick="showSubTab('p-members')" id="s-members" class="portal-nav-btn active">
                    <i class="fas fa-users-line text-lg"></i>
                    <span class="text-[8px] font-bold uppercase mt-2">Registry</span>
                </button>
                <button onclick="showSubTab('p-finance')" id="s-finance" class="portal-nav-btn">
                    <i class="fas fa-coins text-lg text-emerald-500"></i>
                    <span class="text-[8px] font-bold uppercase mt-2">Ledger</span>
                </button>
                <button onclick="showSubTab('p-admin')" id="s-admin" class="portal-nav-btn hidden">
                    <i class="fas fa-user-gear text-lg text-blue-600"></i>
                    <span class="text-[8px] font-bold uppercase mt-2">Manage</span>
                </button>
                <button onclick="showTab('home')" class="portal-nav-btn">
                    <i class="fas fa-house text-lg text-slate-400"></i>
                    <span class="text-[8px] font-bold uppercase mt-2">Exit</span>
                </button>
            </div>

            <!-- PORTAL SUB-TABS -->
            <div id="p-members" class="p-sub-tab active">
                <div class="bg-white rounded-3xl border shadow-sm p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-black text-xs uppercase text-slate-400 tracking-widest">Member Registry</h3>
                        <span class="text-[10px] font-bold text-slate-300" id="registryCount">--</span>
                    </div>
                    <div id="listDisplay" class="divide-y space-y-2"></div>
                </div>
            </div>

            <div id="p-finance" class="p-sub-tab hidden">
                <div class="bg-slate-900 rounded-3xl p-6 text-white mb-6 flex justify-between items-center">
                    <div>
                        <p class="text-[9px] font-bold uppercase opacity-60 mb-1">Total Accumulated Funds</p>
                        <h2 id="totalFinance" class="text-3xl font-black">0/=</h2>
                    </div>
                    <div class="w-12 h-12 bg-white/10 rounded-full flex items-center justify-center">
                        <i class="fas fa-vault text-emerald-400"></i>
                    </div>
                </div>
                <div class="bg-white rounded-3xl border shadow-sm p-6">
                    <h3 class="font-black text-xs uppercase text-slate-400 mb-4 tracking-widest">Financial Records</h3>
                    <div id="financeDisplay" class="divide-y"></div>
                </div>
            </div>

            <div id="p-admin" class="p-sub-tab hidden space-y-6">
                <!-- ADD MEMBER -->
                <div class="bg-white border rounded-3xl p-6 shadow-sm">
                    <h3 class="font-black text-sm uppercase text-slate-800 mb-4 flex items-center gap-2">
                        <i class="fas fa-user-plus text-emerald-500"></i> Add New Member
                    </h3>
                    <div class="grid gap-3">
                        <input id="newName" type="text" placeholder="Full Name" class="border p-3 rounded-xl text-sm font-bold w-full bg-slate-50">
                        <input id="newAmt" type="number" placeholder="Initial Contribution (Ksh)" class="border p-3 rounded-xl text-sm font-bold w-full bg-slate-50">
                        <button onclick="addNewMember()" class="bg-slate-800 text-white font-black py-3 rounded-xl text-xs uppercase tracking-widest active:scale-95 transition">Register Member</button>
                    </div>
                </div>

                <!-- EDIT / REMOVE MEMBER -->
                <div class="bg-white border-2 border-blue-500/20 rounded-3xl p-6 shadow-xl">
                    <h3 class="font-black text-sm uppercase text-slate-800 mb-4 flex items-center gap-2">
                        <i class="fas fa-user-pen text-blue-500"></i> Edit / Remove Member
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-[10px] font-black uppercase text-slate-400 mb-1 block ml-1">Select Member</label>
                            <select id="admSelect" onchange="loadMemberToEdit()" class="w-full border p-3 rounded-xl font-bold bg-slate-50 text-sm"></select>
                        </div>
                        <div id="editFields" class="hidden space-y-3 pt-4 border-t border-dashed">
                            <input id="editName" type="text" placeholder="Update Name" class="border p-3 rounded-xl text-sm font-bold w-full">
                            <input id="editAmt" type="number" placeholder="Update Money (Total)" class="border p-3 rounded-xl text-sm font-bold w-full">
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="saveAdminData()" class="bg-blue-600 text-white font-black py-4 rounded-xl text-[10px] uppercase tracking-widest">Save Changes</button>
                                <button onclick="removeMember()" class="bg-red-50 text-red-600 border border-red-100 font-black py-4 rounded-xl text-[10px] uppercase tracking-widest">Remove Member</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-900 rounded-2xl p-4">
                    <h4 class="text-[9px] font-black text-emerald-500 uppercase tracking-widest mb-3">Live System Log</h4>
                    <div id="logScreen" class="audit-log"></div>
                </div>
            </div>
        </section>

    </main>

    <!-- MOBILE BOTTOM NAV -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t p-3 flex justify-around items-center md:hidden z-50">
        <button onclick="showTab('home')" class="flex flex-col items-center gap-1 text-slate-400 active:text-emerald-500">
            <i class="fas fa-house text-sm"></i>
            <span class="text-[8px] font-bold uppercase">Home</span>
        </button>
        <button onclick="handlePortalAccess()" class="flex flex-col items-center gap-1 text-slate-400 active:text-emerald-500">
            <i class="fas fa-id-card text-sm"></i>
            <span class="text-[8px] font-bold uppercase">Portal</span>
        </button>
    </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyDOwV2LyxvZlUSpqiqBFsTAO5CVTSBI940", 
            authDomain: "mitua-cbo.firebaseapp.com", 
            projectId: "mitua-cbo", 
            storageBucket: "mitua-cbo.appspot.com", 
            messagingSenderId: "1027796270356", 
            appId: "1:1027796270356:web:d7bb6dd472bc8038129601" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let userRole = 'public';
        let membersData = [];

        function init() {
            db.collection('members').orderBy('n').onSnapshot(snap => {
                membersData = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                renderMembers();
                document.getElementById('statMembers').innerText = membersData.length;
                document.getElementById('registryCount').innerText = `${membersData.length} TOTAL`;
            });

            db.collection('activity').orderBy('time', 'desc').limit(20).onSnapshot(snap => {
                if(userRole === 'leader') {
                    const logs = snap.docs.map(doc => {
                        const d = doc.data();
                        return `[${d.type.toUpperCase()}] ${d.msg}`;
                    }).join('<br>');
                    const logEl = document.getElementById('logScreen');
                    if(logEl) logEl.innerHTML = logs || 'No recent activity.';
                }
            });
        }

        function renderMembers() {
            const listEl = document.getElementById('listDisplay');
            const finEl = document.getElementById('financeDisplay');
            const admSel = document.getElementById('admSelect');
            let total = 0;

            listEl.innerHTML = '';
            finEl.innerHTML = '';
            admSel.innerHTML = '<option value="">-- Choose Member to Manage --</option>';

            membersData.forEach(m => {
                const amt = Number(m.amt) || 0;
                total += amt;

                listEl.innerHTML += `
                    <div class="flex items-center gap-4 py-3">
                        <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-500 text-xs">${m.n.charAt(0)}</div>
                        <div>
                            <p class="font-bold text-slate-800 text-sm leading-none">${m.n}</p>
                            <p class="text-[9px] font-bold text-slate-400 uppercase mt-1">Official Member</p>
                        </div>
                    </div>
                `;

                finEl.innerHTML += `
                    <div class="flex justify-between items-center py-4">
                        <span class="font-bold text-slate-700 text-sm">${m.n}</span>
                        <span class="font-black text-emerald-600 text-sm">${amt.toLocaleString()}/=</span>
                    </div>
                `;

                admSel.innerHTML += `<option value="${m.id}">${m.n}</option>`;
            });

            document.getElementById('totalFinance').innerText = `${total.toLocaleString()}/=`;
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            const target = document.getElementById(tabId);
            if(target) target.classList.add('active');
            const btn = document.getElementById('btn-' + tabId);
            if(btn) btn.classList.add('active');
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function showSubTab(subId) {
            document.querySelectorAll('.p-sub-tab').forEach(c => c.classList.add('hidden'));
            document.querySelectorAll('.portal-nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(subId).classList.remove('hidden');
            const btnId = subId.replace('p-', 's-');
            const btn = document.getElementById(btnId);
            if(btn) btn.classList.add('active');
        }

        function triggerLogin() {
            Swal.fire({
                title: 'PORTAL ACCESS',
                text: 'Select Access Role',
                showDenyButton: true,
                confirmButtonText: 'Leader (Edit)',
                denyButtonText: 'Member (View)',
                confirmButtonColor: '#059669',
                denyButtonColor: '#2c3e50'
            }).then(r => {
                if(r.isConfirmed) promptPIN('leader', '1234');
                else if(r.isDenied) promptPIN('member', '9999');
            });
        }

        function promptPIN(role, pin) {
            Swal.fire({ title: 'Enter PIN', input: 'password' }).then(r => {
                if(r.value === pin) {
                    userRole = role;
                    if(role === 'leader') document.getElementById('s-admin').classList.remove('hidden');
                    else document.getElementById('s-admin').classList.add('hidden');
                    showTab('portal');
                    showSubTab('p-members');
                } else {
                    Swal.fire('Access Denied', 'Invalid security PIN.', 'error');
                }
            });
        }

        function handlePortalAccess() {
            if(userRole === 'public') triggerLogin();
            else showTab('portal');
        }

        function scrollToSupport() {
            const el = document.getElementById('support-section');
            el.scrollIntoView({ behavior: 'smooth' });
            el.classList.add('ring-4', 'ring-emerald-500/50');
            setTimeout(() => el.classList.remove('ring-4', 'ring-emerald-500/50'), 2000);
        }

        function loadMemberToEdit() {
            const id = document.getElementById('admSelect').value;
            if(!id) {
                document.getElementById('editFields').classList.add('hidden');
                return;
            }
            const member = membersData.find(m => m.id === id);
            document.getElementById('editName').value = member.n;
            document.getElementById('editAmt').value = member.amt || 0;
            document.getElementById('editFields').classList.remove('hidden');
        }

        async function addNewMember() {
            const name = document.getElementById('newName').value.trim();
            const amt = Number(document.getElementById('newAmt').value);
            if(!name) return Swal.fire('Error', 'Name is required', 'error');

            try {
                await db.collection('members').add({ n: name, amt: amt });
                Swal.fire({ icon: 'success', title: 'Member Added', toast: true, position: 'top-end', timer: 2000, showConfirmButton: false });
                document.getElementById('newName').value = '';
                document.getElementById('newAmt').value = '';
                logAction(`Added member: ${name}`);
            } catch(e) { console.error(e); }
        }

        async function saveAdminData() {
            const id = document.getElementById('admSelect').value;
            const name = document.getElementById('editName').value.trim();
            const amt = Number(document.getElementById('editAmt').value);
            if(!id || !name) return;

            try {
                await db.collection('members').doc(id).update({ n: name, amt: amt });
                Swal.fire({ icon: 'success', title: 'Updated Successfully', toast: true, position: 'top-end', timer: 2000, showConfirmButton: false });
                logAction(`Updated member: ${name} (Ksh ${amt})`);
            } catch(e) { console.error(e); }
        }

        async function removeMember() {
            const id = document.getElementById('admSelect').value;
            if(!id) return;
            
            const result = await Swal.fire({
                title: 'Are you sure?',
                text: "This member will be permanently removed from the CBO list!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                confirmButtonText: 'Yes, remove them'
            });

            if(result.isConfirmed) {
                try {
                    await db.collection('members').doc(id).delete();
                    Swal.fire('Deleted!', 'Member has been removed.', 'success');
                    document.getElementById('editFields').classList.add('hidden');
                    logAction(`Removed member ID: ${id}`);
                } catch(e) { console.error(e); }
            }
        }

        function logAction(msg) {
            db.collection('activity').add({
                type: 'admin',
                msg: msg,
                time: firebase.firestore.FieldValue.serverTimestamp()
            });
        }

        init();
    </script>
</body>
</html>

